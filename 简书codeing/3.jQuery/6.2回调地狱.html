<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            padding: 0px;
            margin: 0px;
        }
        .tpl {
            display: none;
        }
        .wrapper {
            overflow: hidden;
            border: 2px solid black;
            width: 600px;
            margin: 100px auto 0px;
        }
        .movieSection {
            float: left;
            width: 180px;
            height: 180px;
            padding: 10px;
        }
        .movieSection img {
            width: 100%;
            height: 150px;
            cursor: pointer;
        }
        .movieSection h3 {
            height: 30px;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class='tpl'>
            <img src=""></img>
            <h3 class='movieName'></h3>            
        </div>
    </div>     
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        // 回调地狱(三角区) -> 其不符合单一职责原则、开闭原则 ->每个独立的$.ajax()获取后台接口url符合单一职责原则，但从全局考虑，第一个$.ajax()的成功回调函数包含的内容太多，在里面又发送多个请求，不符合单一职责原则； 开闭原则：其扩展性、维护性很差
        $.ajax({
            url: 'https://easy-mock.com/mock/5c09f40d3c098813c612cce6/movie/power',
            type: 'POST',
            data: {
                username: 'cst',
                password: '123123'
            },
            success: function (res) {
                if (res.data.power == 'root') {
                    // vip 网络地址发送请求
                    $.ajax({
                        url: 'https://easy-mock.com/mock/5c09f40d3c098813c612cce6/movie/movieList',
                        type: 'GET',
                        success: function (res) {
                            console.log(res)
                            var data = res.data;
                            var $Wrapper = $('.wrapper');//开发中变量命名规则：对象以O开头，jQuery中变量以$开头
                            $.each(data, function(index, ele) {
                                // 巧妙利用clone(); -> 克隆模版
                                var $MovieSection = $('.tpl').clone().removeClass('tpl').addClass('movieSection');
                                $MovieSection.data({id: ele.id}).on('click', function (){    
                                    $.ajax({
                                        url: 'https://easy-mock.com/mock/5c09f40d3c098813c612cce6/movie/movieInfo',
                                        type: 'GET',
                                        data: {
                                            movieId: $(this).data('id')
                                        },
                                        success: function (res) {
                                            var data = res.data;
                                            var direct = data.direct;
                                            var gut = data.gut;
                                            var mainActor = data.mainActor;
                                            var screenWriter = data.screenwriter;
                                            var htmlStr = '<div class="mask">\
                                                <p>导演: ' + direct + '</p>\
                                                <p>剧情: ' + gut + '</p>\
                                                <p>主演: ' + mainActor.reduce(function (prev, curv) {
                                                    prev += curv + ' ';
                                                    return prev;
                                                }, '') + '</p>\
                                                <p>编剧: ' + screenWriter.reduce(function (prev, curv) {
                                                    prev += curv + ' ';
                                                    return prev;
                                                }, '') + '</p>\
                                            </div>'
                                            $(htmlStr)
                                                .appendTo('body')
                                                    .css({position: 'absolute', left: $(window).outerWidth() / 2, bottom: 100, width: 400, marginLeft: -200});
                                        }
                                    });
                                }).children()
                                    .eq(0).attr('src', ele.poster)
                                        .next().text(ele.name);

                                $Wrapper.append($MovieSection);
                            });
                        }
                    })
                }else {
                    // 非vip 
                }
            }
        });
    </script>
</body>
</html>